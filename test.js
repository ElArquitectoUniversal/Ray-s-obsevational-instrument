const search_parameters = {
    'search_by_int_case': 6,
    'search_by_timestamp': '1155.610',
    'input_search_by_timestamp': 14.185
}

const input_session_object = {
    '3.403': [[0,0,0,0,0,0],[1,0,0,0],[1,1,0]],
    '14.185': [[0,1,0,0,0,0],[1,0,0,0],[1,1,0]],
    '14.934': [[0,1,0,0,0,0],[1,0,0,0],[1,1,0]],
    '16.186': [[0,1,0,0,0,0],[1,0,0,0],[1,1,0]],
    '16.938': [[0,1,0,0,0,0],[1,0,0,0],[1,1,0]],
    '31.268': [[0,0,0,0,0,1],[1,0,0,0],[1,1,0]],
    '35.267': [[0,0,0,0,0,1],[1,0,0,0],[1,1,0]],
    '35.268': [[0,0,0,0,0,1],[1,0,0,0],[1,1,0]],
    '42.267': [[0,0,0,0,0,1],[1,0,0,0],[1,1,0]],
    '42.268': [[0,0,0,0,0,1],[1,0,0,0],[1,1,0]],
    '47.568': [[0,0,0,0,0,1],[1,0,0,0],[1,1,0]],
    '54.102': [[0,0,0,1,0,0],[1,0,0,0],[1,1,0]],
    '57.602': [[0,0,0,1,0,0],[1,0,0,0],[1,1,0]],
    '66.901': [[0,0,0,1,0,0],[1,0,0,0],[1,1,0]],
    '66.902': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '76.938': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '79.939': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '84.937': [[0,0,0,1,0,0],[1,0,0,0],[1,1,0]],
    '94.940': [[0,0,0,1,0,0],[1,0,0,0],[1,1,0]],
    '98.440': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '99.537': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '102.444': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '102.784': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '113.572': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '117.325': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '121.324': [[0,0,0,0,0,1],[1,0,0,0],[1,1,0]],	
    '135.371': [[0,0,0,0,0,1],[1,0,0,0],[1,1,0]],
    '135.671': [[0,0,0,0,0,1],[1,0,0,0],[1,1,0]],
    '135.672': [[0,0,1,1,0,0],[1,0,0,0],[1,1,0]],
    '154.220': [[0,0,1,1,0,0],[1,0,0,0],[1,1,0]],
    '167.536': [[0,0,1,1,0,0],[1,0,0,0],[1,1,0]],
    '167.537': [[1,0,0,0,0,0],[1,0,0,0],[1,1,0]],
    '171.544': [[1,0,0,0,0,0],[1,0,0,0],[1,1,0]],
    '175.296': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '176.543': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '184.291': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '184.292': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '194.155': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '199.906': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '199.921': [[0,0,0,1,0,0],[1,0,0,0],[1,1,0]],
    '209.169': [[0,0,0,1,0,0],[1,0,0,0],[1,1,0]],
    '215.455': [[1,0,0,0,0,0],[1,0,0,0],[1,1,0]],
    '221.713': [[1,0,0,0,0,0],[1,0,0,0],[1,1,0]],
    '228.738': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '239.743': [[0,0,0,0,1,0],[1,0,0,0],[1,1,0]],
    '251.356': [[1,0,0,0,0,0],[1,0,0,0],[1,1,0]],
    '256.361': [[1,0,0,0,0,0],[1,0,0,0],[1,1,0]],
    '258.359': [[0,0,0,1,1,0],[1,0,0,0],[1,1,0]],
    '269.863': [[0,0,0,1,1,0],[1,0,0,0],[1,1,0]],
    '271.861': [[1,0,0,0,0,0],[1,0,0,0],[1,1,0]],
    '278.360': [[1,0,0,0,0,0],[1,0,0,0],[1,1,0]],
    '280.359': [[1,0,0,0,0,0],[1,0,0,0],[1,1,0]],
    '280.360': [[0,0,0,0,1,0],[0,1,0,0],[1,1,1]],
    '280.986': [[0,0,0,0,1,0],[0,1,0,0],[1,1,1]],
    '287.736': [[0,0,0,0,1,0],[0,1,0,0],[1,1,1]],
    '287.858': [[0,0,0,0,1,0],[0,1,0,0],[1,1,1]],
    '299.293': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '303.569': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '308.825': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '309.336': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '339.090': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '341.589': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '349.090': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '352.091': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '352.092': [[1,0,0,0,0,0],[0,1,0,0],[1,1,1]],
    '357.841': [[1,0,0,0,0,0],[0,1,0,0],[1,1,1]],
    '364.842': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '370.586': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '378.588': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '382.869': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '396.620': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '399.369': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '402.369': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '402.705': [[0,0,0,1,0,0],[0,1,0,0],[1,1,0]],
    '431.708': [[0,0,0,1,0,0],[0,1,0,0],[1,1,0]],
    '431.709': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '440.458': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '445.702': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '457.456': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],	
    '474.985': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '478.237': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '480.985': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '492.052': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '492.053': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '495.303': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '495.804': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '502.086': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '502.087': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '504.334': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '506.336': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '512.851': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '512.852': [[0,0,0,1,1,0],[0,0,1,1],[0,1,0]],
    '526.436': [[0,0,0,1,1,0],[0,0,1,1],[0,1,0]],
    '526.437': [[1,0,0,0,0,0],[0,0,1,1],[0,1,0]],
    '536.685': [[1,0,0,0,0,0],[0,0,1,1],[0,1,0]],
    '538.685': [[1,0,0,0,0,0],[0,0,1,1],[0,1,0]],
    '538.686': [[1,0,0,0,0,0],[0,1,0,0],[1,1,1]],
    '543.185': [[1,0,0,0,0,0],[0,1,0,0],[1,1,1]],
    '552.686': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '552.785': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '560.319': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '563.584': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '567.085': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '567.586': [[1,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '581.902': [[1,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '581.903': [[1,0,0,1,1,0],[0,0,1,1],[0,1,0]],
    '582.402': [[1,0,0,1,1,0],[0,0,1,1],[0,1,0]],
    '582.902': [[0,0,0,1,0,0],[0,0,1,1],[0,1,0]],
    '586.401': [[0,0,0,1,0,0],[0,0,1,1],[0,1,0]],
    '586.402': [[0,0,0,1,0,0],[1,0,0,1],[0,1,0]],
    '587.900': [[0,0,0,1,0,0],[1,0,0,1],[0,1,0]],
    '587.901': [[1,0,0,1,1,0],[1,0,0,1],[0,1,0]],
    '604.185': [[1,0,0,1,1,0],[1,0,0,1],[0,1,0]],
    '604.436': [[1,0,0,0,0,0],[1,0,0,1],[0,1,0]],
    '614.436': [[1,0,0,0,0,0],[1,0,0,1],[0,1,0]],
    '615.935': [[1,0,0,0,0,0],[1,0,0,1],[0,1,0]],
    '615.936': [[0,0,0,0,1,0],[0,1,0,0],[1,1,1]],
    '616.436': [[0,0,0,0,1,0],[0,1,0,0],[1,1,1]],
    '620.685': [[0,0,0,0,1,0],[0,1,0,0],[1,1,1]],
    '632.601': [[0,0,0,0,1,0],[0,1,0,0],[1,1,1]],
    '632.602': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '633.602': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '640.602': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '640.603': [[1,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '659.952': [[1,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '660.902': [[1,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '660.903': [[0,0,0,1,0,0],[0,0,1,1],[0,1,0]],
    '661.219': [[0,0,0,1,0,0],[0,0,1,1],[0,1,0]],
    '687.470': [[0,0,0,1,0,0],[0,0,1,1],[0,1,0]],
    '688.970': [[1,0,0,0,0,0],[0,0,1,1],[0,1,0]],
    '702.724': [[1,0,0,0,0,0],[0,0,1,1],[0,1,0]],
    '704.221': [[1,0,0,0,0,0],[0,0,1,1],[0,1,0]],
    '704.222': [[0,1,0,0,1,0],[0,1,0,0],[1,1,1]],
    '704.652': [[0,1,0,0,1,0],[0,1,0,0],[1,1,1]],
    '710.902': [[0,1,0,0,1,0],[0,1,0,0],[1,1,1]],
    '711.901': [[0,1,0,0,1,0],[0,1,0,0],[1,1,1]],
    '720.417': [[0,0,0,0,0,1],[0,1,0,0],[1,1,0]],
    '730.703': [[0,0,0,0,0,1],[0,1,0,0],[1,1,0]],
    '740.951': [[0,0,0,0,0,1],[0,1,0,0],[1,1,0]],
    '740.952': [[0,0,0,0,0,1],[1,1,0,0],[1,1,1]],
    '743.036': [[0,0,0,0,0,1],[0,1,0,0],[1,1,1]],
    '743.037': [[0,1,0,0,1,0],[0,1,0,0],[1,1,1]],
    '748.035': [[0,1,0,0,1,0],[0,1,0,0],[1,1,1]],
    '751.553': [[0,0,0,1,1,0],[0,1,0,0],[1,1,1]],
    '766.586': [[0,0,0,1,1,0],[0,1,0,0],[1,1,1]],
    '767.637': [[1,0,0,0,0,0],[0,1,0,0],[1,1,1]],
    '776.637': [[1,0,0,0,0,0],[0,1,0,0],[1,1,1]],
    '781.685': [[1,0,0,0,0,0],[0,1,0,0],[1,1,1]],
    '784.443': [[1,0,0,0,0,0],[0,1,0,0],[1,1,1]],
    '789.973': [[0,1,0,0,0,0],[0,1,0,0],[1,1,1]],
    '790.970': [[0,1,0,0,0,0],[0,1,0,0],[1,1,1]],
    '793.489': [[0,1,0,0,0,0],[0,1,0,0],[1,1,1]],
    '795.739': [[0,1,0,0,0,0],[0,1,0,0],[1,1,1]],
    '811.806': [[0,0,0,1,0,0],[0,1,0,0],[1,1,1]],
    '820.301': [[0,0,0,1,0,0],[0,1,0,0],[1,1,1]],
    '830.888': [[0,0,0,1,0,0],[0,1,0,0],[1,1,1]],
    '845.138': [[0,0,0,1,0,0],[0,1,0,0],[1,1,1]],
    '853.956': [[0,0,0,1,0,0],[0,1,0,0],[1,1,1]],
    '863.954': [[0,0,0,1,0,0],[0,1,0,0],[1,1,1]],
    '868.774': [[0,0,0,1,1,0],[0,1,0,0],[1,1,1]],
    '873.279': [[0,0,0,1,1,0],[0,1,0,0],[1,1,1]],
    '882.521': [[0,1,0,1,1,0],[0,1,0,0],[1,1,1]],
    '886.527': [[0,1,0,1,1,0],[0,1,0,0],[1,1,1]],
    '891.871': [[0,1,0,0,0,0],[0,1,0,0],[1,1,1]],
    '893.873': [[0,1,0,0,0,0],[0,1,0,0],[1,1,1]],
    '894.634': [[0,1,0,0,0,0],[0,1,0,0],[1,1,1]],
    '896.622': [[0,0,0,0,1,0],[0,1,0,0],[1,1,1]],
    '896.907': [[0,0,0,0,1,0],[0,1,0,0],[1,1,1]],
    '901.157': [[0,0,0,0,1,0],[0,1,0,0],[1,1,1]],
    '901.403': [[0,0,0,0,1,0],[0,1,0,0],[1,1,1]],
    '907.671': [[0,1,0,0,1,0],[0,1,0,0],[1,1,0]],
    '907.688': [[0,1,0,0,1,0],[0,1,0,0],[1,1,0]],
    '912.195': [[0,1,0,0,1,0],[0,1,0,0],[1,1,0]],
    '913.455': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '972.918': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '973.673': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '973.674': [[0,1,0,0,1,0],[1,1,0,0],[1,1,1]],
    '976.189': [[0,1,0,0,1,0],[0,1,0,0],[1,1,1]],
    '980.189': [[0,1,0,0,1,0],[0,1,0,0],[1,1,1]],
    '988.255': [[0,1,0,1,1,0],[0,1,0,0],[1,1,1]],
    '992.758': [[0,1,0,1,1,0],[0,1,0,0],[1,1,1]],
    '995.754': [[1,0,0,0,0,0],[0,1,0,0],[1,1,1]],
    '999.760': [[1,0,0,0,0,0],[0,1,0,0],[1,1,1]],
    '1000.540': [[1,0,0,0,0,0],[1,1,0,0],[1,1,1]],
    '1001.290': [[0,1,0,0,1,0],[0,1,0,0],[1,1,1]],
    '1001.556': [[0,1,0,0,1,0],[0,1,0,0],[1,1,1]],
    '1007.556': [[0,1,0,0,1,0],[0,1,0,0],[1,1,1]],
    '1017.306': [[0,1,0,0,1,0],[0,1,0,0],[1,1,1]],
    '1017.307': [[0,1,0,0,0,0],[0,1,0,0],[1,1,0]],
    '1020.889': [[0,1,0,0,0,0],[0,1,0,0],[1,1,0]],
    '1026.887': [[0,1,0,0,0,0],[0,1,0,0],[1,1,0]],
    '1028.652': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '1053.735': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '1053.756': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '1055.757': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '1058.752': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '1060.256': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '1061.754': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '1069.512': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '1073.009': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '1076.257': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '1088.888': [[0,1,0,0,1,0],[0,1,0,0],[1,1,0]],
    '1093.643': [[0,1,0,0,1,0],[0,1,0,0],[1,1,0]],
    '1096.142': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '1128.896': [[0,0,0,1,1,0],[0,1,0,0],[1,1,0]],
    '1131.889': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '1140.392': [[1,0,0,0,0,0],[0,1,0,0],[1,1,0]],
    '1142.585': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '1152.869': [[0,0,0,0,1,0],[0,1,0,0],[1,1,0]],
    '1155.610': [[0,0,0,0,0,0],[0,1,0,0],[1,1,0]]
}

function get_string_case(i,j,k) {
    let string_abilities;
    let string_object_property;
    let string_object;

    let abilities_possible_cases = {0: "Conteo",1: "Identificacion Cardinal",2: "Identificacion Ordinal",3: "Variacion Cardinal",4: "Correspondecia Digito Objeto Palabra",5: "Otras"};
    let object_property_possible_cases = {0: "Instruir",1: "Instigar",2: "Señalar",3: "Discriminar"};
    let object_possible_cases = {0: "Ficha",1: "Cubo",2: "Enseñante"}
    
    if (i in abilities_possible_cases && j in object_property_possible_cases && k in object_possible_cases) {
        string_abilities = abilities_possible_cases[i];
        string_object_property = object_property_possible_cases[j];
        string_object = object_possible_cases[k];
    }
    
    return [string_abilities, string_object_property, string_object];    
}

function get_int_case(key_case) {
    let int_case;
    let possible_cases = {"111": 1,"110": 2,"101": 3,"000": 4,"001": 5,"010": 6,"100": 7,"011": 8};
    if (key_case in possible_cases) {
        int_case = possible_cases[key_case];
    }
    return int_case;
}

function analyze(input_session_object){
    let test;

    let output_session_object = {};
    let chart_data = [];
    let object_keys = Object.keys(input_session_object);
    for (let x = 0; x < object_keys.length; x++) {
        const timestamp = object_keys[x];
        let key_cases_array = [];
        let timestamp_array = input_session_object[timestamp];
        let timestamp_array_abilities = timestamp_array[0];
        let timestamp_array_object_property = timestamp_array[1];
        let timestamp_array_object = timestamp_array[2];  
        //OBJETO CON INDICE OBTENIDO EN GET_STRING_CASE()
        let output_object_son = {};
        for (let i = 0, l = timestamp_array_abilities.length; i < l; i++){
            for (let j = 0, k = 0, m = timestamp_array_object_property.length, n = timestamp_array_object.length; j < m; j++){
                let string_array = get_string_case(i,j,k);
                let string_abilities = string_array[0];
                let string_object_property = string_array[1];
                let string_object = string_array[2];
                //OBTENCIÓN DEL INT CASE
                let key_case = `${timestamp_array_abilities[i]}${timestamp_array_object_property[j]}${timestamp_array_object[k]}`;  
                let int_case = get_int_case(key_case);
                //CHART
                if (key_case == '011' || key_case == '111') {
                    const reducer = (previousValue, currentValue) => previousValue + currentValue;
                    let complete_case = [parseInt(timestamp_array_abilities[i]),parseInt(timestamp_array_object_property[j]),parseInt(timestamp_array_object[k])];
                    let reduce_case = complete_case.reduce(reducer)
                    key_cases_array.push(reduce_case);
                }else{
                    key_cases_array.push(0);
                }
                //DECLARACIÓN DEL INDICE DEL OBJETO (STRING) EL PARAMETRO ES UN OBJETO
                let output_object_son_index = `${string_abilities} // ${string_object_property} // ${string_object}`;
                output_object_son[output_object_son_index] = int_case;
                if (j == m - 1 && k < n - 1){
                    k++;
                    j = -1;
                }
            }
        }
        chart_data.push(key_cases_array);
        output_session_object[timestamp] = output_object_son;
    }
    //return output_session_object; 
    return chart_data
}

function search_by_int_case(analyzed_session_object, search) {
    let important_cases_object = {};
    let object_keys = Object.keys(analyzed_session_object);

    for (let x = 0; x < object_keys.length; x++) {
        const timestamp = object_keys[x];
        let object_son = analyzed_session_object[timestamp];
        let object_son_keys = Object.keys(object_son);
        let output_object_son = {};
        for (let y = 0; y < object_son_keys.length; y++) {
            const string_index = object_son_keys[y];
            let int_case = object_son[string_index];
            if (int_case == search) {
                output_object_son[string_index] = int_case;
            }
        }
        important_cases_object[timestamp] = output_object_son;
    }
    return important_cases_object;
}

function search_by_timestamp(analyzed_session_object, search) {
    return analyzed_session_object[search];
}

function input_search_by_timestamp(input_session_object, search) {
    return input_session_object[search]
}


let layout = {
    title: "Ray's Observational Instrument 1st Session",
    autosize: false,
    width: 700,
    height: 700,
    margin: {
      l: 65,
      r: 50,
      b: 65,
      t: 90,
    }
}



  


Plotly.newPlot('chart', [{ //multiple traces
    z: analyze(input_session_object),
    type: 'surface'
}], layout);


function search_trace() {
    let search = document.getElementById("trace").value;

    let trace = {
        y: analyze(input_session_object)[search],
        type: 'scatter'
    };

    var data = [trace];

    Plotly.newPlot('chart_time', data , layout);
    
}


console.log(analyze(input_session_object));

//console.log(search_by_int_case(analyze(input_session_object), search_parameters.search_by_int_case));

//console.log(search_by_timestamp(analyze(input_session_object), search_parameters.search_by_timestamp));

//console.log(input_search_by_timestamp(input_session_object, search_parameters.input_search_by_timestamp));